Cyber Essentials Plus – Scan Preparation

This document details the procedure for implementing the settings required for the Cyber Essentials Plus on site assessment. These steps are also required if you are wanting to perform your own vulnerability scan before the on-site Cyber Essentials Plus assessment. Note you must be logged into a Windows Administrator account to perform these changes.
The required changes include:
•	Enable AccountTokenFilterPolicy in the Windows Registry 
•	Starting the WMI Service
•	Changing the StartMode of the RemoteRegistry from Disabled to Manual
•	Starting the RemoteRegistry Service
•	Enable File and Printer Sharing group on the Windows Firewall
These changes should be reverted after the on-site assessment. It is possible to change these settings via running the provided PowerShell script on local machines, or by running the commands manually. If your organisation is using Active Directory, then these settings can be changed via the Group Policy interface by your systems administrator. 
NOTE: If your organisation has a IT department, using Active directory or the manual method is preferred [see end of document for manual PowerShell commands]. 
















PowerShell Scripts for Local Use:
Two PowerShell Script files are required to be downloaded and placed on the Desktop of the Administrator User. Alternativley the PowerShell commands can be entered and reviewed manually in the proceeding section.
These files can be found in the same directory as this guide.

Search for powershell, right click and Run as administrator

 








Type “set-executionpolicy -executionpolicy remotesigned”
Type “y” when prompted 
 
Navigate to the Admin users Desktop by Typing “cd C:\Users\INSERTADMINUSER\Desktop\”
NOTE: Change INSERTADMINUSER with the name of the administrator account

Type “dir” to list files within the Admin Desktop, ensure both client-prep-on.ps1 and client-prep-off.ps1 are present.

 
Type “.\client-prep-on.ps1” to run the preparation program.
 

The machine is now ready to be assessed for Cyber Essentials Plus
Once the onsite Cyber Essentials Plus assessment has completed please repeat the last stage although run the second “client-prep-off.ps1” program instead with 
“.\client-prep-off.ps1”


















Alternative | Manual PowerShell Commands for Local Use:
Note: PowerShell must be opened as an Administrator then execute the following commands. 
Before Assessment: 
1.	New-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'LocalAccountTokenFilterPolicy' -Value 1 -PropertyType DWORD -Force | Out-Null
2.	(gwmi win32_service -filter "name='Winmgmt'").startservice()
3.	(gwmi win32_service -filter "name='RemoteRegistry'").ChangeStartMode("Manual")
4.	(gwmi win32_service -filter "name='RemoteRegistry'").startservice()
5.	netsh advfirewall export C:\advfirewallpolicy.wfw
6.	netsh advfirewall firewall set rule group="File and Printer Sharing" new enable=Yes
Command Details
1.	Enable AccountTokenFilterPolicy in the Windows Registry 
2.	Starting the WMI Service
3.	Changing the StartMode of the RemoteRegistry from Disabled to Manual
4.	Starting the RemoteRegistry Service
5.	Save / Export current Firewall Configuration to C:\advfirewallpolicy.wfw
6.	Enable File and Printer Sharing group on the Windows Firewall

After Assessment:
1.	New-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'LocalAccountTokenFilterPolicy' -Value 0 -PropertyType DWORD -Force | Out-Null
2.	(gwmi win32_service -filter "name='RemoteRegistry'").ChangeStartMode("Disabled")
3.	(gwmi win32_service -filter "name='RemoteRegistry'").stopservice()
4.	netsh advfirewall import C:\advfirewallpolicy.wfw
5.	Remove-Item C:\advfirewallpolicy.wfw
Command Details
1.	Disable AccountTokenFilterPolicy in the Windows Registry 
2.	Changing the StartMode of the RemoteRegistry from Manual to Disabled
3.	Stop the RemoteRegistry Service
4.	Import previous [pre-test] Firewall Configuration from C:\advfirewallpolicy.wfw
5.	Remove / Cleanup C:\advfirewallpolicy.wfw file


